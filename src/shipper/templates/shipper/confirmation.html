<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        height: 300px;
        width: 50%;
      }
      .marker {
        background-image: url('/static/imgs/CargoFul Logo-12.png');
        background-size: cover;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
      }
      .mapboxgl-popup {
        max-width: 200px;
      }
      .mapboxgl-popup-content {
        text-align: center;
        font-family: 'Open Sans', sans-serif;
      }
    </style>
</head>
<body>

<div id='map'></div>

<script>

mapboxgl.accessToken = 'pk.eyJ1IjoicmZpdGNoIiwiYSI6ImNrN3dqdTYwYjAzNzUzZm85NXRreXo0bTcifQ.SNWvUpiNG9Q7EAQakLFsbw';

var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/light-v10',
  center: [{{mid_long}}, {{mid_lat}}],
  zoom: 3
});

// code from the next step will go here!

var geojson = {
  type: 'FeatureCollection',
  features: [{
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [{{pu_long}}, {{pu_lat}}]
    },
    properties: {
      title: 'Pickup Location',
      description: '{{pu_addy}}'
    }
  },
  {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [{{del_long}}, {{del_lat}}]
    },
    properties: {
      title: 'Delivery Location',
      description: '{{del_addy}}'
    }
  }]
};

// add markers to map
geojson.features.forEach(function(marker) {

  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add to the map
  new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
    .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
    .addTo(map);
});
</script>

  <form action = 'order_placed' method = "post">{% csrf_token %}
    <table>
      <!-- pickup address info -->
      <tr>
        <td class = 'label'><b>Pickup Address</b></td>
      </tr>
      <!--
      <tr>
        <td class="label">Street</td>
        <td class="slimField"><input class="field" id="street_number" value = {{pu_st_number}} disabled="true"/></td>
        <td class="wideField" colspan="2"><input class="field" id="route" value = "{{pu_st_route}}" disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">City</td>
        <td class="wideField" colspan="3"><input class="field" id="locality" value = '{{pu_city}}' disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">State</td>
        <td class="slimField"><input class="field" id="administrative_area_level_1" value = '{{pu_state}}' disabled="true"/></td>
        <td class="label">Zip Code</td>
        <td class="wideField"><input class="field" id="postal_code" value = {{pu_zip}} disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">Country</td>
        <td class="wideField" colspan="3"><input class="field" id="country" value = '{{pu_country}}' disabled="true"/></td>
      </tr> -->
      <tr>
        <td class = 'widefield'><input class = 'field' id = 'addy' value = '{{pu_addy}}' size = '60' disabled = 'true'/></td>
      </tr>
      <!-- delivery address info -->
      <tr>
        <td class = 'label'> </td> <!-- this is just here to add an empty space -->
      </tr>
      <tr>
        <td class = 'label'><b> Delivery Address</b></td>
      </tr>
      <!--
      <tr>
        <td class="label">Street</td>
        <td class="slimField"><input class="field" id="street_number" value = {{del_st_number}} disabled="true"/></td>
        <td class="wideField" colspan="2"><input class="field" id="route" value = "{{del_st_route}}" disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">City</td>
        <td class="wideField" colspan="3"><input class="field" id="locality" value = '{{del_city}}' disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">State</td>
        <td class="slimField"><input class="field" id="administrative_area_level_1" value = '{{del_state}}' disabled="true"/></td>
        <td class="label">Zip Code</td>
        <td class="wideField"><input class="field" id="postal_code" value = {{del_zip}} disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">Country</td>
        <td class="wideField" colspan="3"><input class="field" id="country" value = '{{del_country}}' disabled="true"/></td>
      </tr> -->
      <tr>
        <td class = 'widefield'><input class = 'field' id = 'addy' value = '{{del_addy}}' size = '60' disabled = 'true'/></td>
      </tr>
    <!-- other order info -->
      <tr>
        <td class = 'label'><b>Order Specs</b></td>
      </tr>
      <tr>
        <td class = 'label'>Pickup Date</td>
        <td class = 'widefield'><input class = 'field' id = 'date' name = 'pickup_date' type = 'date' value = {{date}} readonly></td>
      </tr>
      <tr>
        <td class = 'label'> Pickup Time</td>
        <td class = 'widefield'><input class = 'field' id = 'time' name = 'pickup_time' type = 'time' value = {{time}} readonly></td>
      </tr>
      <tr>
        <td class = 'label'> Truck Type</td>
        <td class = 'widefield'><input class = 'field' id = 'truck_type' name = 'truck_type' type = 'text' value = "{{truck}}" readonly></td>
      </tr>
      <tr>
        <td class = 'label'> Contents</td>
        <td class = 'widefield'><input class = 'field' id = 'contents' name = 'contents' type = 'text' value = "{{cargo}}" readonly></td>
      </tr>
      <tr>
        <td class = 'label'> Instructions</td>
        <td class = 'widefield'><input class = 'field' id = 'instructions' name = 'instructions' type = 'text' value = "{{instruct}}" readonly></td>
      </tr>
      <tr>
        <td class = 'label'> Price </td>
        <td class = 'widefield'><input class = 'field' id = 'price' name = 'price' type = 'number' step = '0.01' value = {{price}} readonly></td>
      </tr>
      <!-- distance of order + lat and lng for pickup and delivery (hidden from user) -->
      <tr>
        <td class = 'widefield'><input class = 'field' id = 'pu_lat' name = 'pickup_latitude' type = 'number' value = {{pu_lat}} hidden = 'true' readonly></td>
        <td class = 'widefield'><input class = 'field' id = 'pu_long' name = 'pickup_longitude' type = 'number' value = {{pu_long}} hidden = 'true' readonly></td>
        <td class = 'widefield'><input class = 'field' id = 'del_lat' name = 'delivery_latitude' type = 'number' value = {{del_lat}} hidden = 'true' readonly></td>
        <td class = 'widefield'><input class = 'field' id = 'del_long' name = 'delivery_longitude' type = 'number' value = {{del_long}} hidden = 'true' readonly></td>
        <td class = 'widefield'><input class = 'field' id = 'distance' name = 'distance' type = 'number' value = {{distance}} hidden = 'true' readonly></td>
      </tr>
    </table>
        <input type="submit" value="Confirm Order">
  </form>

  <a href="/shipper" class="btn btn-secondary btn-lg active" role="button" aria-pressed="true">Cancel Order</a>
</body>
</html>
